<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>
</head>
<body>
  <h2>ЁЯФе ржкрзНрж░рзЛржбрж╛ржХрзНржЯ ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ (рж╢рзБржзрзБ ржПржбржорж┐ржи)</h2>
  <button onclick="logout()">ЁЯЪк рж▓ржЧржЖржЙржЯ</button><br><br>

  <input type="text" id="name" placeholder="ржирж╛ржо">
  <input type="text" id="price" placeholder="ржорзВрж▓рзНржп">
  <input type="text" id="img" placeholder="ржЗржорзЗржЬ URL">
  <button onclick="addProduct()">тЮХ ржпрзБржХрзНржд ржХрж░рзБржи</button>

  <ul id="productList"></ul>

  <script type="module">
    import { auth, onAuthStateChanged, signOut, db, collection, addDoc, deleteDoc, doc, getDocs } from './firebase.js';

    const productsRef = collection(db, "products");

    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = "login.html"; // Redirect if not logged in
      } else {
        loadProducts();
      }
    });

    window.logout = async function () {
      await signOut(auth);
      window.location.href = "login.html";
    };

    window.addProduct = async function () {
      const name = document.getElementById("name").value;
      const price = document.getElementById("price").value;
      const img = document.getElementById("img").value;

      await addDoc(productsRef, { name, price, img });
      loadProducts();
    };

    window.deleteProduct = async function (id) {
      await deleteDoc(doc(db, "products", id));
      loadProducts();
    };

    async function loadProducts() {
      const list = document.getElementById("productList");
      list.innerHTML = "";

      const snapshot = await getDocs(productsRef);
      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        const li = document.createElement("li");
        li.innerHTML = `
          <img src="${data.img}" width="50" /> ${data.name} - ${data.price}
          <button onclick="deleteProduct('${docSnap.id}')">тЭМ</button>
        `;
        list.appendChild(li);
      });
    }
  </script>
</body>
</html>
